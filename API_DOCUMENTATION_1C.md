# API Документация для выгрузки данных из 1С

## Содержание

1. [Общая информация](#общая-информация)
2. [Последовательность выгрузки](#последовательность-выгрузки)
3. [Эндпоинты API](#эндпоинты-api)
   - [Рукопожатие (Handshake)](#1-рукопожатие-handshake)
   - [Метаданные конфигурации](#2-метаданные-конфигурации-metadata)
   - [Константы](#3-константы-constant)
   - [Метаданные справочника](#4-метаданные-справочника-catalogmeta)
   - [Элементы справочника](#5-элементы-справочника)
   - [Завершение выгрузки](#6-завершение-выгрузки-complete)
4. [Форматы данных](#форматы-данных)
5. [Обработка ошибок](#обработка-ошибок)
6. [Примеры использования](#примеры-использования)

---

## Общая информация

### Базовый URL

Все запросы отправляются на сервер по адресу, указанному в настройках обработки (например, `http://localhost:9999`).

### Формат данных

- **Формат запросов**: XML
- **Формат ответов**: XML
- **Кодировка**: UTF-8
- **Content-Type**: `application/xml; charset=utf-8`

### Эндпоинты

Сервер поддерживает два набора эндпоинтов:

1. **Старые эндпоинты** (для обратной совместимости):
   - `/handshake`
   - `/metadata`
   - `/constant`
   - `/catalog/meta`
   - `/catalog/item`
   - `/catalog/items`
   - `/complete`

2. **Новые эндпоинты** (рекомендуется):
   - `/api/v1/upload/handshake`
   - `/api/v1/upload/metadata`
   - `/api/v1/upload/nomenclature/batch` (для номенклатуры с характеристиками)

### Важные замечания

1. **Для каждой новой выгрузки создается отдельная база данных SQLite** с именем, включающим:
   - Тип выгрузки (Номенклатура, Контрагенты, ПолнаяВыгрузка)
   - Имя конфигурации 1С
   - Имя компьютера
   - Имя пользователя
   - Временную метку
   
   Пример: `Выгрузка_Номенклатура_УТ_11_4_ПК-01_Иванов_2024-01-15_14-30-25.db`

2. **Upload UUID**: При рукопожатии сервер возвращает уникальный идентификатор выгрузки (`upload_uuid`), который необходимо использовать во всех последующих запросах.

3. **Экранирование XML**: Все строковые значения должны быть экранированы для XML:
   - `&` → `&amp;`
   - `<` → `&lt;`
   - `>` → `&gt;`
   - `"` → `&quot;`
   - `'` → `&apos;`

---

## Последовательность выгрузки

Типичная последовательность выгрузки данных:

```
1. Рукопожатие (Handshake)
   ↓
2. Метаданные конфигурации (Metadata)
   ↓
3. Константы (Constant) - для каждой константы отдельный запрос
   ↓
4. Для каждого справочника:
   a) Метаданные справочника (Catalog Meta)
   b) Элементы справочника (Catalog Item/Items)
   ↓
5. Завершение выгрузки (Complete)
```

---

## Эндпоинты API

### 1. Рукопожатие (Handshake)

**Назначение**: Инициализация новой выгрузки. Сервер создает новую базу данных и возвращает `upload_uuid`.

**Эндпоинты**:
- `POST /handshake` (старый)
- `POST /api/v1/upload/handshake` (новый, рекомендуется)

**Запрос**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<handshake>
    <database_id>123</database_id>
    <version_1c>8.3.25.1234</version_1c>
    <config_name>Управление торговлей</config_name>
    <config_version>11.4.5.123</config_version>
    <computer_name>ПК-01</computer_name>
    <user_name>Иванов И.И.</user_name>
    <upload_type>ПолнаяВыгрузка</upload_type>
    <iteration_number>1</iteration_number>
    <iteration_label>Первая выгрузка</iteration_label>
    <programmer_name>Петров П.П.</programmer_name>
    <upload_purpose>Тестовая выгрузка</upload_purpose>
    <parent_upload_id>550e8400-e29b-41d4-a716-446655440000</parent_upload_id>
    <timestamp>2024-01-15T14:30:25</timestamp>
</handshake>
```

**Поля запроса**:

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `database_id` | string | Нет | ID базы данных в service.db (если известен) |
| `version_1c` | string | **Да** | Версия платформы 1С (например, "8.3.25.1234") |
| `config_name` | string | **Да** | Имя конфигурации 1С |
| `config_version` | string | Нет | Версия конфигурации |
| `computer_name` | string | Нет | Имя компьютера |
| `user_name` | string | Нет | Имя пользователя |
| `upload_type` | string | Нет | Тип выгрузки: "ПолнаяВыгрузка", "Номенклатура", "Контрагенты" (по умолчанию: "ПолнаяВыгрузка") |
| `iteration_number` | int | Нет | Номер итерации (по умолчанию: 1) |
| `iteration_label` | string | Нет | Метка итерации |
| `programmer_name` | string | Нет | Имя программиста |
| `upload_purpose` | string | Нет | Цель выгрузки |
| `parent_upload_id` | string | Нет | UUID родительской выгрузки (для связанных выгрузок) |
| `timestamp` | string | Нет | Временная метка в формате ISO 8601 |

**Ответ (успех)**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<handshake_response>
    <success>true</success>
    <upload_uuid>550e8400-e29b-41d4-a716-446655440000</upload_uuid>
    <client_name>ООО "Рога и Копыта"</client_name>
    <project_name>Проект 1</project_name>
    <database_name>Выгрузка_Номенклатура_УТ_11_4_ПК-01_Иванов_2024-01-15_14-30-25.db</database_name>
    <database_path>Выгрузка_Номенклатура_УТ_11_4_ПК-01_Иванов_2024-01-15_14-30-25.db</database_path>
    <database_id>456</database_id>
    <message>Handshake successful</message>
    <timestamp>2024-01-15T14:30:25+03:00</timestamp>
</handshake_response>
```

**Ответ (ошибка)**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<error_response>
    <success>false</success>
    <error>Missing required field: version_1c</error>
    <message>Failed to parse request</message>
    <timestamp>2024-01-15T14:30:25+03:00</timestamp>
</error_response>
```

**Важно**: Сохраните `upload_uuid` из ответа - он потребуется для всех последующих запросов.

---

### 2. Метаданные конфигурации (Metadata)

**Назначение**: Отправка общей информации о конфигурации 1С.

**Эндпоинты**:
- `POST /metadata` (старый)
- `POST /api/v1/upload/metadata` (новый, рекомендуется)

**Запрос**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<metadata>
    <upload_uuid>550e8400-e29b-41d4-a716-446655440000</upload_uuid>
    <database_id>123</database_id>
    <version_1c>8.3.25.1234</version_1c>
    <config_name>Управление торговлей</config_name>
    <config_version>11.4.5.123</config_version>
    <computer_name>ПК-01</computer_name>
    <user_name>Иванов И.И.</user_name>
    <timestamp>2024-01-15T14:30:25</timestamp>
</metadata>
```

**Поля запроса**:

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `upload_uuid` | string | **Да** | UUID выгрузки, полученный при рукопожатии |
| `database_id` | string | Нет | ID базы данных |
| `version_1c` | string | **Да** | Версия платформы 1С |
| `config_name` | string | **Да** | Имя конфигурации |
| `config_version` | string | Нет | Версия конфигурации |
| `computer_name` | string | Нет | Имя компьютера |
| `user_name` | string | Нет | Имя пользователя |
| `timestamp` | string | Нет | Временная метка |

**Ответ (успех)**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<metadata_response>
    <success>true</success>
    <message>Metadata received successfully</message>
    <timestamp>2024-01-15T14:30:25+03:00</timestamp>
</metadata_response>
```

---

### 3. Константы (Constant)

**Назначение**: Отправка значения константы из 1С.

**Эндпоинт**: `POST /constant`

**Запрос**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<constant>
    <upload_uuid>550e8400-e29b-41d4-a716-446655440000</upload_uuid>
    <name>Организация</name>
    <synonym>Организация</synonym>
    <type>СправочникСсылка.Организации</type>
    <value>
        <СправочникСсылка.Организации>
            <Код>00001</Код>
            <Наименование>ООО "Рога и Копыта"</Наименование>
        </СправочникСсылка.Организации>
    </value>
    <timestamp>2024-01-15T14:30:25</timestamp>
</constant>
```

**Поля запроса**:

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `upload_uuid` | string | **Да** | UUID выгрузки |
| `name` | string | **Да** | Имя константы |
| `synonym` | string | **Да** | Синоним константы |
| `type` | string | **Да** | Тип константы (например, "СправочникСсылка.Организации") |
| `value` | XML | **Да** | Значение константы в виде XML (может быть любой структуры) |
| `timestamp` | string | Нет | Временная метка |

**Важно**: Поле `value` может содержать произвольный XML. Сервер сохраняет его как есть.

**Ответ (успех)**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<constant_response>
    <success>true</success>
    <message>Constant added successfully</message>
    <timestamp>2024-01-15T14:30:25+03:00</timestamp>
</constant_response>
```

**Примеры значений констант**:

1. **Строка**:
```xml
<value>Простое текстовое значение</value>
```

2. **Число**:
```xml
<value>123.45</value>
```

3. **Дата**:
```xml
<value>2024-01-15T14:30:25</value>
```

4. **Справочник**:
```xml
<value>
    <СправочникСсылка.Организации>
        <Код>00001</Код>
        <Наименование>ООО "Рога и Копыта"</Наименование>
    </СправочникСсылка.Организации>
</value>
```

5. **Структура**:
```xml
<value>
    <Структура>
        <Поле1>Значение1</Поле1>
        <Поле2>Значение2</Поле2>
    </Структура>
</value>
```

---

### 4. Метаданные справочника (Catalog Meta)

**Назначение**: Регистрация справочника перед отправкой его элементов. **Обязательно** вызывать перед отправкой элементов справочника.

**Эндпоинт**: `POST /catalog/meta`

**Запрос**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<catalog_meta>
    <upload_uuid>550e8400-e29b-41d4-a716-446655440000</upload_uuid>
    <name>Номенклатура</name>
    <synonym>Номенклатура</synonym>
    <timestamp>2024-01-15T14:30:25</timestamp>
</catalog_meta>
```

**Поля запроса**:

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `upload_uuid` | string | **Да** | UUID выгрузки |
| `name` | string | **Да** | Имя справочника (как в метаданных 1С) |
| `synonym` | string | **Да** | Синоним справочника |
| `timestamp` | string | Нет | Временная метка |

**Ответ (успех)**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<catalog_meta_response>
    <success>true</success>
    <catalog_id>1</catalog_id>
    <message>Catalog metadata added successfully</message>
    <timestamp>2024-01-15T14:30:25+03:00</timestamp>
</catalog_meta_response>
```

**Важно**: 
- Метаданные справочника должны быть отправлены **до** отправки элементов этого справочника.
- Если вы используете виртуальные справочники (например, "НоменклатураСХарактеристиками"), обязательно отправьте их метаданные перед отправкой элементов.

---

### 5. Элементы справочника

#### 5.1. Отправка одного элемента (Catalog Item)

**Назначение**: Отправка одного элемента справочника.

**Эндпоинт**: `POST /catalog/item`

**Запрос**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<catalog_item>
    <upload_uuid>550e8400-e29b-41d4-a716-446655440000</upload_uuid>
    <catalog_name>Номенклатура</catalog_name>
    <reference>550e8400-e29b-41d4-a716-446655440001</reference>
    <code>00001</code>
    <name>Товар 1</name>
    <attributes>{"Артикул": "ART-001", "ПолноеНаименование": "Товар 1 (полное)"}</attributes>
    <table_parts>{"Цены": [{"Цена": 100, "ТипЦены": "Розничная"}]}</table_parts>
    <timestamp>2024-01-15T14:30:25</timestamp>
</catalog_item>
```

**Поля запроса**:

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `upload_uuid` | string | **Да** | UUID выгрузки |
| `catalog_name` | string | **Да** | Имя справочника (должно совпадать с именем, указанным в метаданных) |
| `reference` | string | **Да** | Уникальный идентификатор элемента (UUID или строка) |
| `code` | string | **Да** | Код элемента |
| `name` | string | **Да** | Наименование элемента |
| `attributes` | string | Нет | Реквизиты элемента в формате JSON или XML (строка) |
| `table_parts` | string | Нет | Табличные части в формате JSON или XML (строка) |
| `timestamp` | string | Нет | Временная метка |

**Ответ (успех)**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<catalog_item_response>
    <success>true</success>
    <message>Catalog item added successfully</message>
    <timestamp>2024-01-15T14:30:25+03:00</timestamp>
</catalog_item_response>
```

#### 5.2. Пакетная отправка элементов (Catalog Items)

**Назначение**: Отправка нескольких элементов справочника одним запросом (рекомендуется для больших объемов данных).

**Эндпоинт**: `POST /catalog/items`

**Запрос**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<catalog_items>
    <upload_uuid>550e8400-e29b-41d4-a716-446655440000</upload_uuid>
    <catalog_name>Номенклатура</catalog_name>
    <items>
        <item>
            <reference>550e8400-e29b-41d4-a716-446655440001</reference>
            <code>00001</code>
            <name>Товар 1</name>
            <attributes>{"Артикул": "ART-001"}</attributes>
            <table_parts></table_parts>
            <timestamp>2024-01-15T14:30:25</timestamp>
        </item>
        <item>
            <reference>550e8400-e29b-41d4-a716-446655440002</reference>
            <code>00002</code>
            <name>Товар 2</name>
            <attributes>{"Артикул": "ART-002"}</attributes>
            <table_parts></table_parts>
            <timestamp>2024-01-15T14:30:25</timestamp>
        </item>
    </items>
</catalog_items>
```

**Поля запроса**:

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `upload_uuid` | string | **Да** | UUID выгрузки |
| `catalog_name` | string | **Да** | Имя справочника |
| `items` | array | **Да** | Массив элементов (каждый элемент имеет те же поля, что и в `/catalog/item`) |

**Ответ (успех)**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<catalog_items_response>
    <success>true</success>
    <processed_count>2</processed_count>
    <failed_count>0</failed_count>
    <message>Processed 2 items, 0 failed</message>
    <timestamp>2024-01-15T14:30:25+03:00</timestamp>
</catalog_items_response>
```

#### 5.3. Пакетная отправка номенклатуры с характеристиками (Nomenclature Batch)

**Назначение**: Специальный эндпоинт для отправки номенклатуры с характеристиками. Каждый элемент представляет собой комбинацию номенклатуры и характеристики.

**Эндпоинт**: `POST /api/v1/upload/nomenclature/batch`

**Запрос**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<nomenclature_batch>
    <upload_uuid>550e8400-e29b-41d4-a716-446655440000</upload_uuid>
    <database_id>123</database_id>
    <items>
        <item>
            <nomenclature_reference>550e8400-e29b-41d4-a716-446655440001</nomenclature_reference>
            <nomenclature_code>00001</nomenclature_code>
            <nomenclature_name>Товар 1</nomenclature_name>
            <characteristic_reference>550e8400-e29b-41d4-a716-446655440010</characteristic_reference>
            <characteristic_name>Размер 42</characteristic_name>
            <attributes>{"Артикул": "ART-001-42"}</attributes>
            <table_parts></table_parts>
            <timestamp>2024-01-15T14:30:25</timestamp>
        </item>
        <item>
            <nomenclature_reference>550e8400-e29b-41d4-a716-446655440001</nomenclature_reference>
            <nomenclature_code>00001</nomenclature_code>
            <nomenclature_name>Товар 1</nomenclature_name>
            <characteristic_reference>550e8400-e29b-41d4-a716-446655440011</characteristic_reference>
            <characteristic_name>Размер 44</characteristic_name>
            <attributes>{"Артикул": "ART-001-44"}</attributes>
            <table_parts></table_parts>
            <timestamp>2024-01-15T14:30:25</timestamp>
        </item>
    </items>
    <timestamp>2024-01-15T14:30:25</timestamp>
</nomenclature_batch>
```

**Поля запроса**:

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `upload_uuid` | string | **Да** | UUID выгрузки |
| `database_id` | string | Нет | ID базы данных |
| `items` | array | **Да** | Массив элементов номенклатуры с характеристиками |
| `timestamp` | string | Нет | Временная метка |

**Поля элемента**:

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `nomenclature_reference` | string | **Да** | Ссылка на номенклатуру |
| `nomenclature_code` | string | **Да** | Код номенклатуры |
| `nomenclature_name` | string | **Да** | Наименование номенклатуры |
| `characteristic_reference` | string | Нет | Ссылка на характеристику (если есть) |
| `characteristic_name` | string | Нет | Наименование характеристики (если есть) |
| `attributes` | string | Нет | Реквизиты в формате JSON или XML |
| `table_parts` | string | Нет | Табличные части в формате JSON или XML |
| `timestamp` | string | Нет | Временная метка |

**Ответ (успех)**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<nomenclature_batch_response>
    <success>true</success>
    <processed_count>2</processed_count>
    <failed_count>0</failed_count>
    <message>Processed 2 nomenclature items</message>
    <timestamp>2024-01-15T14:30:25+03:00</timestamp>
</nomenclature_batch_response>
```

---

### 6. Завершение выгрузки (Complete)

**Назначение**: Завершение выгрузки. Сервер финализирует выгрузку и запускает анализ качества данных.

**Эндпоинт**: `POST /complete`

**Запрос**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<complete>
    <upload_uuid>550e8400-e29b-41d4-a716-446655440000</upload_uuid>
    <timestamp>2024-01-15T14:30:25</timestamp>
</complete>
```

**Поля запроса**:

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| `upload_uuid` | string | **Да** | UUID выгрузки |
| `timestamp` | string | Нет | Временная метка |

**Ответ (успех)**:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<complete_response>
    <success>true</success>
    <message>Upload completed successfully</message>
    <timestamp>2024-01-15T14:30:25+03:00</timestamp>
</complete_response>
```

---

## Форматы данных

### Формат Attributes и TableParts

Поля `attributes` и `table_parts` могут быть представлены в двух форматах:

1. **JSON** (рекомендуется):
```json
{"Артикул": "ART-001", "ПолноеНаименование": "Товар 1 (полное)"}
```

2. **XML** (в виде строки):
```xml
<Реквизиты>
    <Артикул>ART-001</Артикул>
    <ПолноеНаименование>Товар 1 (полное)</ПолноеНаименование>
</Реквизиты>
```

**Важно**: При использовании XML внутри строки необходимо экранировать специальные символы:
- `<` → `&lt;`
- `>` → `&gt;`
- `&` → `&amp;`
- `"` → `&quot;`
- `'` → `&apos;`

### Формат Timestamp

Временные метки должны быть в формате ISO 8601:
- `2024-01-15T14:30:25` (без часового пояса)
- `2024-01-15T14:30:25+03:00` (с часовым поясом)

---

## Обработка ошибок

### Коды состояния HTTP

- `200 OK` - запрос успешно обработан
- `400 Bad Request` - неверный формат запроса
- `404 Not Found` - ресурс не найден (например, upload_uuid не существует)
- `405 Method Not Allowed` - неверный HTTP метод (должен быть POST)
- `500 Internal Server Error` - внутренняя ошибка сервера

### Формат ответа об ошибке

```xml
<?xml version="1.0" encoding="UTF-8"?>
<error_response>
    <success>false</success>
    <error>sql: no rows in result set</error>
    <message>Catalog not found</message>
    <timestamp>2024-01-15T14:30:25+03:00</timestamp>
</error_response>
```

### Типичные ошибки

1. **"Upload not found"**
   - Причина: `upload_uuid` не существует или неверен
   - Решение: Проверьте правильность UUID, полученного при рукопожатии

2. **"Catalog not found"**
   - Причина: Элементы справочника отправлены до отправки метаданных справочника
   - Решение: Сначала отправьте метаданные справочника через `/catalog/meta`

3. **"Missing required field: version_1c"**
   - Причина: Не указано обязательное поле
   - Решение: Проверьте наличие всех обязательных полей в запросе

4. **"Failed to parse XML"**
   - Причина: Неверный формат XML
   - Решение: Проверьте корректность XML и экранирование специальных символов

---

## Примеры использования

### Пример 1: Полная выгрузка справочника

```1c
// 1. Рукопожатие
ИдентификаторВыгрузки = ВыполнитьРукопожатиеСПривязкой("ПолнаяВыгрузка");

// 2. Метаданные конфигурации
ОтправитьМетаданныеНаСервер();

// 3. Константы
Для Каждого Константа Из Константы Цикл
    ОтправитьКонстантуНаСервер(Константа);
КонецЦикла;

// 4. Для каждого справочника
Для Каждого Справочник Из Справочники Цикл
    // 4a. Метаданные справочника
    ОтправитьМетаСправочникаНаСервер(Справочник);
    
    // 4b. Элементы справочника (пакетно)
    МассивЭлементов = Новый Массив;
    Для Каждого Элемент Из Справочник Цикл
        МассивЭлементов.Добавить(ПодготовитьЭлементДляОтправки(Элемент));
        
        Если МассивЭлементов.Количество() >= 100 Тогда
            ОтправитьПакетЭлементовСправочника(Справочник.Имя, МассивЭлементов);
            МассивЭлементов.Очистить();
        КонецЕсли;
    КонецЦикла;
    
    // Отправляем оставшиеся элементы
    Если МассивЭлементов.Количество() > 0 Тогда
        ОтправитьПакетЭлементовСправочника(Справочник.Имя, МассивЭлементов);
    КонецЕсли;
КонецЦикла;

// 5. Завершение выгрузки
ЗавершитьВыгрузкуНаСервере();
```

### Пример 2: Выгрузка только номенклатуры

```1c
// 1. Рукопожатие
ИдентификаторВыгрузки = ВыполнитьРукопожатиеСПривязкой("Номенклатура");

// 2. Метаданные конфигурации
ОтправитьМетаданныеНаСервер();

// 3. Метаданные справочника "Номенклатура"
ОтправитьМетаСправочникаНаСервер(Метаданные.Справочники["Номенклатура"]);

// 4. Метаданные виртуального справочника "НоменклатураСХарактеристиками"
ВиртуальныйСправочник = Новый Структура;
ВиртуальныйСправочник.Вставить("Имя", "НоменклатураСХарактеристиками");
ВиртуальныйСправочник.Вставить("Синоним", "Номенклатура с характеристиками");
ОтправитьМетаСправочникаВиртуальный(ВиртуальныйСправочник);

// 5. Выгрузка номенклатуры с характеристиками
ВыгрузитьНоменклатуруСХарактеристикамиЧерезHTTP();

// 6. Завершение выгрузки
ЗавершитьВыгрузкуНаСервере();
```

### Пример 3: Функция экранирования XML

```1c
Функция ЭкранироватьXML(Строка)
    
    Результат = Строка;
    Результат = СтрЗаменить(Результат, "&", "&amp;");
    Результат = СтрЗаменить(Результат, "<", "&lt;");
    Результат = СтрЗаменить(Результат, ">", "&gt;");
    Результат = СтрЗаменить(Результат, """", "&quot;");
    Результат = СтрЗаменить(Результат, "'", "&apos;");
    
    Возврат Результат;
    
КонецФункции
```

### Пример 4: Отправка HTTP запроса

```1c
Функция ОтправитьHTTPЗапрос(Метод, URL, ТелоЗапроса, ContentType = "application/xml; charset=utf-8")
    
    Попытка
        // Парсим URL
        ПозицияПротокола = СтрНайти(URL, "://");
        Если ПозицияПротокола > 0 Тогда
            URLБезПротокола = Прав(URL, СтрДлина(URL) - ПозицияПротокола - 2);
            ПозицияСлеша = СтрНайти(URLБезПротокола, "/");
            Если ПозицияСлеша > 0 Тогда
                БазовыйАдресСервера = Лев(URLБезПротокола, ПозицияСлеша - 1);
                ПутьЗапроса = Прав(URLБезПротокола, СтрДлина(URLБезПротокола) - ПозицияСлеша + 1);
            Иначе
                БазовыйАдресСервера = URLБезПротокола;
                ПутьЗапроса = "/";
            КонецЕсли;
        Иначе
            БазовыйАдресСервера = URL;
            ПутьЗапроса = "/";
        КонецЕсли;
        
        Заголовки = Новый Соответствие;
        Заголовки.Вставить("Content-Type", ContentType);
        
        HTTPЗапрос = Новый HTTPЗапрос(ПутьЗапроса, Заголовки);
        HTTPЗапрос.Метод = Метод;
        HTTPЗапрос.УстановитьТелоИзСтроки(ТелоЗапроса, КодировкаТекста.UTF8);
        
        HTTPСоединение = Новый HTTPСоединение(БазовыйАдресСервера, , , , , 30);
        Ответ = HTTPСоединение.ОтправитьДляОбработки(HTTPЗапрос);
        
        Возврат Ответ;
        
    Исключение
        ВызватьИсключение "Ошибка отправки HTTP запроса: " + ОписаниеОшибки();
    КонецПопытки;
    
КонецФункции
```

---

## Дополнительные замечания

1. **Производительность**: Для больших объемов данных используйте пакетную отправку (`/catalog/items` вместо множественных вызовов `/catalog/item`).

2. **Таймауты**: Рекомендуется устанавливать таймаут для HTTP соединения не менее 30 секунд.

3. **Повторные попытки**: При ошибках сети рекомендуется реализовать механизм повторных попыток с экспоненциальной задержкой.

4. **Логирование**: Сохраняйте логи всех запросов и ответов для отладки.

5. **Валидация**: Проверяйте ответы сервера перед продолжением выгрузки.

---

## Контакты и поддержка

При возникновении проблем проверьте:
1. Логи сервера
2. Корректность формата XML
3. Экранирование специальных символов
4. Последовательность вызовов API

---

*Документация актуальна на 2024-01-15*




