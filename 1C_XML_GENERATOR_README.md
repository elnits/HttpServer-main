# Генератор XML обработки 1С

## Описание

Добавлен новый API endpoint для генерации актуального XML файла обработки 1С. Endpoint всегда возвращает самую свежую версию обработки, объединяя все актуальные модули.

## Endpoint

```
GET /api/1c/processing/xml
```

## Использование

### Через браузер

Откройте в браузере:
```
http://localhost:9999/api/1c/processing/xml
```

Файл автоматически скачается с именем вида `1c_processing_export_YYYYMMDD_HHMMSS.xml`

### Через curl

```bash
curl -O http://localhost:9999/api/1c/processing/xml
```

Или с указанием имени файла:
```bash
curl -o my_processing.xml http://localhost:9999/api/1c/processing/xml
```

### Через PowerShell

```powershell
Invoke-WebRequest -Uri "http://localhost:9999/api/1c/processing/xml" -OutFile "1c_processing_export.xml"
```

## Как это работает

1. Endpoint читает следующие файлы:
   - `1c_processing/Module/Module.bsl` - основной модуль обработки
   - `1c_module_extensions.bsl` - расширения модуля (опционально)
   - `1c_export_functions.txt` - экспортируемые функции (опционально)

2. Объединяет код модулей:
   - Сначала базовый модуль
   - Затем область "ПрограммныйИнтерфейс" из `1c_export_functions.txt`
   - Затем расширения из `1c_module_extensions.bsl`

3. Генерирует новый UUID для обработки при каждом запросе

4. Формирует XML файл в формате 1С для импорта в конфигуратор

## Преимущества

- ✅ Всегда актуальная версия - файл генерируется на лету из текущих исходников
- ✅ Автоматическое объединение всех модулей
- ✅ Уникальный UUID при каждой генерации
- ✅ Готов к импорту в конфигуратор 1С
- ✅ Не требует ручного запуска Python скрипта

## Формат ответа

- **Content-Type**: `application/xml; charset=utf-8`
- **Content-Disposition**: `attachment; filename="1c_processing_export_YYYYMMDD_HHMMSS.xml"`
- **HTTP Status**: `200 OK`

## Обработка ошибок

- Если основной файл `Module.bsl` не найден - возвращается ошибка 500
- Если файлы расширений отсутствуют - они игнорируются, генерация продолжается
- Все ошибки логируются в лог сервера

## Пример использования в скрипте

```bash
#!/bin/bash
# Автоматическое получение актуального XML обработки
curl -s http://localhost:9999/api/1c/processing/xml -o 1c_processing_export.xml
echo "XML файл обработки обновлен"
```

## Интеграция с существующим процессом

Этот endpoint заменяет необходимость в ручном запуске `create_1c_xml.py`. Теперь можно:

1. Получить актуальный XML через API
2. Импортировать его в конфигуратор 1С
3. Использовать обработку для выгрузки данных

## Примечания

- UUID обработки генерируется заново при каждом запросе
- Файл всегда содержит самую свежую версию кода из исходников
- Формат XML соответствует стандарту 1С версии 8.3

