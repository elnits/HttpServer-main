# Инструкция по установке обработки 1С

## Шаг 1: Подготовка файлов

1. Убедитесь, что у вас есть все файлы из папки `1C_EXT`:
   - `Module.bsl` - основной модуль
   - `ModuleExtensions.bsl` - расширения модуля
   - `FormInstructions.md` - инструкция по настройке формы

## Шаг 2: Создание обработки в конфигураторе

1. Откройте конфигуратор 1С
2. Создайте новую внешнюю обработку:
   - Меню: **Файл → Новый → Внешняя обработка**
   - Или используйте существующую обработку

3. Сохраните обработку с именем, например: `ВыгрузкаДанныхВСервис`

## Шаг 3: Настройка модуля обработки

1. Откройте модуль обработки (двойной клик на "Модуль" в дереве объектов)

2. **Вариант А: Единый модуль**
   - Скопируйте содержимое `Module.bsl` в модуль
   - Скопируйте содержимое `ModuleExtensions.bsl` в конец модуля

3. **Вариант Б: Раздельные модули (рекомендуется)**
   - Скопируйте содержимое `Module.bsl` в основной модуль
   - Создайте новый модуль расширений (если поддерживается вашей версией 1С)
   - Скопируйте содержимое `ModuleExtensions.bsl` в модуль расширений

## Шаг 4: Настройка формы

1. Откройте форму обработки (двойной клик на "Форма" в дереве объектов)

2. Следуйте инструкциям из `FormInstructions.md`:

   **2.1. Добавление реквизитов:**
   - Откройте вкладку "Реквизиты"
   - Добавьте все реквизиты, перечисленные в `FormInstructions.md`
   - Установите типы данных и значения по умолчанию

   **2.2. Создание элементов формы:**
   - Откройте вкладку "Элементы"
   - Создайте группы и элементы согласно инструкции
   - Привяжите элементы к реквизитам формы

   **2.3. Привязка команд:**
   - Откройте вкладку "Команды"
   - Создайте команды для всех кнопок
   - Привяжите команды к процедурам модуля

3. **Важно:** В процедуре `ПриСозданииНаСервере` формы добавьте инициализацию значений по умолчанию (см. `FormInstructions.md`)

## Шаг 5: Проверка установки

1. Сохраните обработку
2. Запустите обработку в режиме предприятия:
   - Меню: **Файл → Открыть обработку**
   - Выберите сохраненную обработку

3. Проверьте работу:
   - Установите адрес сервера (по умолчанию: `http://localhost:9999`)
   - Нажмите кнопку "Проверить соединение"
   - Убедитесь, что соединение установлено

## Шаг 6: Настройка идентификации базы данных

### Вариант 1: Прямой database_id

1. В веб-интерфейсе сервера создайте клиента, проект и базу данных
2. Скопируйте ID базы данных
3. Введите его в поле "Идентификатор базы данных" в форме обработки

### Вариант 2: По client_id и project_id

1. В веб-интерфейсе сервера создайте клиента и проект
2. Скопируйте ID клиента и проекта
3. Введите их в поля "ID клиента" и "ID проекта" в форме обработки
4. При первой выгрузке система автоматически найдет или создаст базу данных

### Вариант 3: Автоматическая идентификация

1. Оставьте поля пустыми
2. Система автоматически определит базу данных по параметрам:
   - Имя компьютера
   - Имя пользователя
   - Имя конфигурации
   - Версия 1С

## Шаг 7: Тестовая выгрузка

1. Убедитесь, что сервер запущен и доступен
2. В форме обработки:
   - Проверьте настройки соединения
   - Нажмите кнопку "Проверить привязку" (если доступна)
   - Нажмите кнопку "ВыгрузкаВсего" для полной выгрузки
   - Или выберите конкретный тип выгрузки

3. Следите за прогрессом выгрузки в индикаторе прогресса

## Устранение неполадок

### Ошибка: "Процедура или функция с указанным именем не определена"

**Причина:** Процедура не найдена в модуле  
**Решение:** 
- Убедитесь, что все процедуры из `ModuleExtensions.bsl` скопированы в модуль
- Проверьте, что процедуры помечены как `Экспорт` (если нужно)

### Ошибка: "Переменная не определена"

**Причина:** Глобальная переменная не объявлена  
**Решение:**
- Убедитесь, что все переменные объявлены в области `СлужебныеПеременные`
- Проверьте, что переменные объявлены в правильном контексте (клиент/сервер)

### Ошибка: "Не удалось получить ответ от сервера"

**Причина:** Сервер недоступен или неправильный адрес  
**Решение:**
- Проверьте, что сервер запущен
- Проверьте адрес сервера в поле "Адрес сервера"
- Проверьте доступность сервера через браузер

### Ошибка: "Не указан database_id или client_id/project_id"

**Причина:** Не указаны параметры для идентификации базы данных  
**Решение:**
- Укажите `database_id` напрямую
- Или укажите `client_id` и `project_id`
- Или используйте автоматическую идентификацию (оставьте поля пустыми)

## Дополнительная информация

- Подробная инструкция по настройке формы: `FormInstructions.md`
- Руководство по интеграции: `IntegrationGuide.md` (если доступно)
- История изменений: `CHANGELOG.md`

